<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è¥¿ä¸­å³¶å—æ–¹é§… å¾’æ­©åœãƒãƒƒãƒ—ï¼ˆãƒªãƒ³ã‚¯ä»˜ãï¼‰</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }
    .control-panel {
      position: absolute; top: 10px; left: 10px; z-index: 1000;
      background: white; padding: 10px 12px; border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15); font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    .control-panel h3 { margin: 0 0 6px; font-size: 16px; }
    .legend { font-size: 12px; line-height: 1.6; }
    .legend label { display: flex; align-items: center; gap: 6px; margin: 2px 0; cursor: pointer; }
    .legend input { transform: translateY(1px); }
    .popup a { text-decoration: none; }
    .footer-note {
      position: absolute; bottom: 6px; right: 10px; z-index: 900;
      background: rgba(255,255,255,0.9); padding: 6px 10px; border-radius: 10px; font-size: 12px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="control-panel">
    <h3>ã‚¸ãƒ£ãƒ³ãƒ«è¡¨ç¤º</h3>
    <div class="legend" id="legend"></div>
  </div>
  <div class="footer-note">â€»ä½æ‰€ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦è¡¨ç¤ºã—ã¾ã™ï¼ˆNominatim / OSMï¼‰ã€‚</div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // Data: name, category, address, url
    const places = [
      // ç„¼è‚‰
      {name: "æ¿å‰ç„¼è‚‰ ä¸€ç¬‘ è¥¿ä¸­å³¶", category: "ç„¼è‚‰", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶5-9-6 æ–°å¤§é˜ªã‚µãƒ³ã‚¢ãƒ¼ãƒ«ãƒ“ãƒ«æœ¬é¤¨1F", url: "https://k726002.gorp.jp/"},
      {name: "è‚‰è™• ãã£ã—ã‚ƒã‚“ è¥¿ä¸­å³¶ç·æœ¬åº—", category: "ç„¼è‚‰", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-13-14 ã‚¿ã‚«ãƒŸãƒ“ãƒ«1éš", url: "https://mjybeef.com/sohonten/"},

      // ç„¼ãé³¥ãƒ»å±…é…’å±‹
      {name: "ä¸ƒè¼ªç„¼é³¥ ä¸€é³¥ è¥¿ä¸­å³¶åº—", category: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-14-9 1F", url: "https://nishinakajima.yakitori-icchou.com/"},
      {name: "å‚™é•·ç‚­ ç„¼ãé³¥ ãˆã‚“ã®ã° è¥¿ä¸­å³¶åº—", category: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-10 æ–°å¤§é˜ªç¬¬2å—ãƒ“ãƒ« 2F", url: "https://s.tabelog.com/osaka/A2701/A270301/27137141/"},
      {name: "ä¸‹ç”ºå±…é…’å±‹ ã‚ã‚ŠãŒãŸã‚„ãã€œ", category: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-19-19 å¯¿ãƒ“ãƒ« 1éš", url: "https://arigatayaa.foodre.jp/"},
      
      // æµ·é®®ãƒ»ç«‹ã¡é£²ã¿
      {name: "é…’ã‚¹ã‚¿ãƒ³ãƒ‰ é­šè”µ è¥¿ä¸­å³¶3ä¸ç›®åº—", category: "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-5 1F", url: "https://kc8d206.gorp.jp/"},
      {name: "ç«‹å–°é…’å ´ é‡‘ç…å­ è¥¿ä¸­å³¶å—æ–¹åº—", category: "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶4-2-8 Y.Sæ–°å¤§é˜ªãƒ“ãƒ« ä¸­1éš", url: "https://s.tabelog.com/osaka/A2701/A270301/27067834/"},

      // ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿
      {name: "ã‚„ãã‚„ãé‰„æ¿ ã¼ã‚“ãã‚‰å®¶ è¥¿ä¸­å³¶åº—", category: "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-19-7 ç¬¬ä¸€ãƒ¦ãƒ¤ãƒãƒ“ãƒ« 1F", url: "https://c770939.gorp.jp/"},
      {name: "ã­ãç„¼ãƒ»ãŠå¥½ã¿ç„¼ã å’Œï¼ˆã‹ãšï¼‰", category: "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-16-6 1F", url: "https://tabelog.com/osaka/A2701/A270301/27018403/"},

      // å¯¿å¸
      {name: "é®¨ãƒ»é…’ãƒ»è‚´ æ‰ç‰ è¥¿ä¸­å³¶å—æ–¹", category: "å¯¿å¸", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-16-6 ä¸‰å¥½ç¬¬2ãƒ“ãƒ«1F", url: "https://www.sugidama-sushiizakaya.jp/shop/505/"},
      {name: "ã‚„ãã‚‰å¯¿ã—", category: "å¯¿å¸", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶1-12-18", url: "https://www.yagurasushi.com/"},

      // ã€†ãƒ©ãƒ¼ãƒ¡ãƒ³
      {name: "äººé¡ã¿ãªéººé¡ï¼ˆè¥¿ä¸­å³¶ï¼‰", category: "ãƒ©ãƒ¼ãƒ¡ãƒ³", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶1-12-15", url: "https://www.jinrui-minamenrui.com/"},
      {name: "éººåŒ  ã¯ãªã¿ã¡ æ–°å¤§é˜ªåº—", category: "ãƒ©ãƒ¼ãƒ¡ãƒ³", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶4-4-25 ãƒ•ãƒ«ãƒ¼ãƒ¬æ–°å¤§é˜ª 1F", url: "https://menshohanamichi.jp/free/shinosaka"},

      // 2è»’ç›®ãƒãƒ¼
      {name: "Public Bar STINGER", category: "ãƒãƒ¼", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-3 5F", url: "https://stinger2017.jp/"}
    ];

    // Category colors (marker emoji for quick visual grouping)
    const categoryMarker = {
      "ç„¼è‚‰": "ğŸ–",
      "ç„¼ãé³¥ãƒ»å±…é…’å±‹": "ğŸ¢",
      "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿": "ğŸŸ",
      "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿": "ğŸ¥",
      "å¯¿å¸": "ğŸ£",
      "ãƒ©ãƒ¼ãƒ¡ãƒ³": "ğŸœ",
      "ãƒãƒ¼": "ğŸ¸"
    };

    // Initialize map centered around Nishinakajima-Minamigata
    const map = L.map('map');
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors'
    }).addTo(map);

    // Layer groups by category
    const layersByCategory = {};
    const bounds = L.latLngBounds();

    // Utility: build a simple emoji DivIcon
    function makeEmojiIcon(emoji) {
      return L.divIcon({
        html: `<div style="font-size:20px; line-height:20px">${emoji}</div>`,
        iconSize: [24, 24],
        className: "emoji-marker"
      });
    }

    // Geocode function using Nominatim
    async function geocode(addr) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`;
      const res = await fetch(url, { headers: { 'Accept-Language': 'ja' } });
      if (!res.ok) throw new Error('geocode failed');
      const data = await res.json();
      if (data && data.length > 0) {
        return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
      }
      return null;
    }

    // Plot all places
    (async () => {
      // Prepare legend checkboxes
      const uniqCategories = [...new Set(places.map(p => p.category))];
      const legendEl = document.getElementById('legend');
      uniqCategories.forEach(cat => {
        const id = `chk-${cat}`;
        const div = document.createElement('div');
        div.innerHTML = `<label><input type="checkbox" id="${id}" checked> ${categoryMarker[cat] || "ğŸ“"} ${cat}</label>`;
        legendEl.appendChild(div);
      });

      // Create layers
      uniqCategories.forEach(cat => {
        layersByCategory[cat] = L.layerGroup().addTo(map);
      });

      for (const p of places) {
        try {
          const latlon = await geocode(p.address);
          if (!latlon) continue;
          const emoji = categoryMarker[p.category] || "ğŸ“";
          const marker = L.marker(latlon, { icon: makeEmojiIcon(emoji), title: p.name });
          const gmUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.address)}`;
          marker.bindPopup(`<div class="popup"><strong>${p.name}</strong><br>
            <span>${p.address}</span><br>
            <a href="${p.url}" target="_blank" rel="noopener">å…¬å¼ãƒšãƒ¼ã‚¸</a> ï½œ
            <a href="${gmUrl}" target="_blank" rel="noopener">Googleãƒãƒƒãƒ—</a>
          </div>`);
          marker.addTo(layersByCategory[p.category]);
          bounds.extend(latlon);
        } catch (e) {
          console.warn('Failed to locate', p.name, e);
        }
      }

      if (bounds.isValid()) {
        map.fitBounds(bounds.pad(0.15));
      } else {
        map.setView([34.733, 135.501], 15); // fallback around è¥¿ä¸­å³¶å—æ–¹
      }

      // Wire up legend checkboxes
      uniqCategories.forEach(cat => {
        const el = document.getElementById(`chk-${cat}`);
        el.addEventListener('change', (e) => {
          if (e.target.checked) {
            layersByCategory[cat].addTo(map);
          } else {
            map.removeLayer(layersByCategory[cat]);
          }
        });
      });
    })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è¥¿ä¸­å³¶å—æ–¹ å¾’æ­©åœãƒãƒƒãƒ—ï¼ˆã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ã‚¢ã‚¤ã‚³ãƒ³ç‰ˆï¼‰</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .panel {
      position: absolute; top: 10px; left: 10px; z-index: 1000;
      background: white; padding: 12px 14px; border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      max-width: 280px;
    }
    .panel h3 { margin: 0 0 8px; font-size: 16px; }
    .legend { font-size: 13px; line-height: 1.6; display: grid; grid-template-columns: 1fr; gap: 6px; }
    .legend label { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .legend input { transform: translateY(1px); }
    .footer-note {
      position: absolute; bottom: 8px; right: 10px; z-index: 900;
      background: rgba(255,255,255,0.9); padding: 6px 10px; border-radius: 10px; font-size: 12px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Generic badge marker styling */
    .badge {
      width: 30px; height: 30px; border-radius: 50%;
      display: grid; place-items: center;
      color: #fff; font-size: 16px; font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.9);
      line-height: 1;
    }
    .badge span { transform: translateY(1px); }

    /* Category colors */
    .c-yakiniku { background: #e74c3c; }         /* èµ¤ */
    .c-yakitori { background: #d35400; }         /* æ©™ */
    .c-kaisen   { background: #2980b9; }         /* é’ */
    .c-okonomi  { background: #8e44ad; }         /* ç´« */
    .c-sushi    { background: #16a085; }         /* ç·‘ */
    .c-ramen    { background: #c0392b; }         /* æ¿ƒèµ¤ */
    .c-bar      { background: #2c3e50; }         /* æ¿ƒç´º */

    .popup a { text-decoration: none; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="panel">
    <h3>ã‚¸ãƒ£ãƒ³ãƒ«è¡¨ç¤ºï¼ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰</h3>
    <div class="legend" id="legend"></div>
  </div>
  <div class="footer-note">â€»ä½æ‰€ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦è¡¨ç¤ºï¼ˆNominatim / OSMï¼‰ã€‚</div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // Data: name, categoryKey, categoryLabel, emoji, address, url
    const places = [
      // ç„¼è‚‰
      {name: "æ¿å‰ç„¼è‚‰ ä¸€ç¬‘ è¥¿ä¸­å³¶", key: "yakiniku", label: "ç„¼è‚‰", emoji: "ğŸ–", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶5-9-6 æ–°å¤§é˜ªã‚µãƒ³ã‚¢ãƒ¼ãƒ«ãƒ“ãƒ«æœ¬é¤¨1F", url: "https://k726002.gorp.jp/"},
      {name: "è‚‰è™• ãã£ã—ã‚ƒã‚“ è¥¿ä¸­å³¶ç·æœ¬åº—", key: "yakiniku", label: "ç„¼è‚‰", emoji: "ğŸ–", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-13-14 ã‚¿ã‚«ãƒŸãƒ“ãƒ«1éš", url: "https://mjybeef.com/sohonten/"},
      // ç„¼ãé³¥ãƒ»å±…é…’å±‹
      {name: "ä¸ƒè¼ªç„¼é³¥ ä¸€é³¥ è¥¿ä¸­å³¶åº—", key: "yakitori", label: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", emoji: "ğŸ¢", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-14-9 1F", url: "https://nishinakajima.yakitori-icchou.com/"},
      {name: "å‚™é•·ç‚­ ç„¼ãé³¥ ãˆã‚“ã®ã° è¥¿ä¸­å³¶åº—", key: "yakitori", label: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", emoji: "ğŸ¢", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-10 æ–°å¤§é˜ªç¬¬2å—ãƒ“ãƒ« 2F", url: "https://s.tabelog.com/osaka/A2701/A270301/27137141/"},
      {name: "ä¸‹ç”ºå±…é…’å±‹ ã‚ã‚ŠãŒãŸã‚„ãã€œ", key: "yakitori", label: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", emoji: "ğŸ¶", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-19-19 å¯¿ãƒ“ãƒ« 1éš", url: "https://arigatayaa.foodre.jp/"},
      // æµ·é®®ãƒ»ç«‹ã¡é£²ã¿
      {name: "é…’ã‚¹ã‚¿ãƒ³ãƒ‰ é­šè”µ è¥¿ä¸­å³¶3ä¸ç›®åº—", key: "kaisen", label: "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿", emoji: "ğŸŸ", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-5 1F", url: "https://kc8d206.gorp.jp/"},
      {name: "ç«‹å–°é…’å ´ é‡‘ç…å­ è¥¿ä¸­å³¶å—æ–¹åº—", key: "kaisen", label: "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿", emoji: "ğŸº", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶4-2-8 Y.Sæ–°å¤§é˜ªãƒ“ãƒ« ä¸­1éš", url: "https://s.tabelog.com/osaka/A2701/A270301/27067834/"},
      // ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿
      {name: "ã‚„ãã‚„ãé‰„æ¿ ã¼ã‚“ãã‚‰å®¶ è¥¿ä¸­å³¶åº—", key: "okonomi", label: "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿", emoji: "ğŸ¥", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-19-7 ç¬¬ä¸€ãƒ¦ãƒ¤ãƒãƒ“ãƒ« 1F", url: "https://c770939.gorp.jp/"},
      {name: "ã­ãç„¼ãƒ»ãŠå¥½ã¿ç„¼ã å’Œï¼ˆã‹ãšï¼‰", key: "okonomi", label: "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿", emoji: "ğŸ¥¢", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-16-6 1F", url: "https://tabelog.com/osaka/A2701/A270301/27018403/"},
      // å¯¿å¸
      {name: "é®¨ãƒ»é…’ãƒ»è‚´ æ‰ç‰ è¥¿ä¸­å³¶å—æ–¹", key: "sushi", label: "å¯¿å¸", emoji: "ğŸ£", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-16-6 ä¸‰å¥½ç¬¬2ãƒ“ãƒ«1F", url: "https://www.sugidama-sushiizakaya.jp/shop/505/"},
      {name: "ã‚„ãã‚‰å¯¿ã—", key: "sushi", label: "å¯¿å¸", emoji: "ğŸ£", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶1-12-18", url: "https://www.yagurasushi.com/"},
      // ãƒ©ãƒ¼ãƒ¡ãƒ³
      {name: "äººé¡ã¿ãªéººé¡ï¼ˆè¥¿ä¸­å³¶ï¼‰", key: "ramen", label: "ãƒ©ãƒ¼ãƒ¡ãƒ³", emoji: "ğŸœ", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶1-12-15", url: "https://www.jinrui-minamenrui.com/"},
      {name: "éººåŒ  ã¯ãªã¿ã¡ æ–°å¤§é˜ªåº—", key: "ramen", label: "ãƒ©ãƒ¼ãƒ¡ãƒ³", emoji: "ğŸœ", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶4-4-25 ãƒ•ãƒ«ãƒ¼ãƒ¬æ–°å¤§é˜ª 1F", url: "https://menshohanamichi.jp/free/shinosaka"},
      // ãƒãƒ¼
      {name: "Public Bar STINGER", key: "bar", label: "ãƒãƒ¼", emoji: "ğŸ¸", address: "å¤§é˜ªåºœå¤§é˜ªå¸‚æ·€å·åŒºè¥¿ä¸­å³¶3-17-3 5F", url: "https://stinger2017.jp/"}
    ];

    // Category -> className mapping (for colors) + legend labels
    const categoryStyles = {
      yakiniku: { cls: "c-yakiniku", label: "ç„¼è‚‰", emoji: "ğŸ–" },
      yakitori: { cls: "c-yakitori", label: "ç„¼ãé³¥ãƒ»å±…é…’å±‹", emoji: "ğŸ¢" },
      kaisen:   { cls: "c-kaisen",   label: "æµ·é®®ãƒ»ç«‹ã¡é£²ã¿", emoji: "ğŸŸ" },
      okonomi:  { cls: "c-okonomi",  label: "ãŠå¥½ã¿ç„¼ããƒ»é‰„æ¿", emoji: "ğŸ¥" },
      sushi:    { cls: "c-sushi",    label: "å¯¿å¸", emoji: "ğŸ£" },
      ramen:    { cls: "c-ramen",    label: "ãƒ©ãƒ¼ãƒ¡ãƒ³", emoji: "ğŸœ" },
      bar:      { cls: "c-bar",      label: "ãƒãƒ¼", emoji: "ğŸ¸" }
    };

    const map = L.map('map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors'
    }).addTo(map);

    // Build legend with checkboxes and icon preview
    const legendEl = document.getElementById('legend');
    const categories = [...new Set(places.map(p => p.key))];
    const layerGroups = {};
    const bounds = L.latLngBounds();

    function iconFor(key, emoji) {
      const cls = categoryStyles[key]?.cls || "";
      return L.divIcon({
        className: "",
        html: `<div class="badge ${cls}"><span>${emoji || "ğŸ“"}</span></div>`,
        iconSize: [30, 30],
        iconAnchor: [15, 15],
        popupAnchor: [0, -12]
      });
    }

    // Geocode via Nominatim
    async function geocode(addr) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`;
      const res = await fetch(url, { headers: { 'Accept-Language': 'ja' } });
      if (!res.ok) throw new Error('geocode failed');
      const data = await res.json();
      if (data && data.length > 0) return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
      return null;
    }

    (async () => {
      // legend items + layers
      categories.forEach((key) => {
        layerGroups[key] = L.layerGroup().addTo(map);
        const { cls, label, emoji } = categoryStyles[key];
        const id = `chk-${key}`;
        const iconHTML = `<span class="badge ${cls}" style="width:20px;height:20px;font-size:12px;border-width:1.5px;"><span>${emoji}</span></span>`;
        const row = document.createElement('label');
        row.innerHTML = `${iconHTML}<input type="checkbox" id="${id}" checked style="margin-left:4px;"> ${label}`;
        legendEl.appendChild(row);

        // checkbox handler
        setTimeout(() => {
          const chk = document.getElementById(id);
          chk.addEventListener('change', (e) => {
            if (e.target.checked) layerGroups[key].addTo(map);
            else map.removeLayer(layerGroups[key]);
          });
        }, 0);
      });

      // plot markers
      for (const p of places) {
        try {
          const latlon = await geocode(p.address);
          if (!latlon) continue;
          const marker = L.marker(latlon, { icon: iconFor(p.key, p.emoji), title: p.name });
          const gmUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.address)}`;
          marker.bindPopup(`<div class="popup"><strong>${p.name}</strong><br>
            <span>${p.address}</span><br>
            <a href="${p.url}" target="_blank" rel="noopener">å…¬å¼ãƒšãƒ¼ã‚¸</a> ï½œ
            <a href="${gmUrl}" target="_blank" rel="noopener">Googleãƒãƒƒãƒ—</a></div>`);
          marker.addTo(layerGroups[p.key]);
          bounds.extend(latlon);
        } catch (e) {
          console.warn("Geocode failed:", p.name, e);
        }
      }

      if (bounds.isValid()) map.fitBounds(bounds.pad(0.15));
      else map.setView([34.733, 135.501], 15);
    })();
  </script>
</body>
</html>

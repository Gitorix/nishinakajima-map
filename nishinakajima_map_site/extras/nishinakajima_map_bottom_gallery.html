<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>è¥¿ä¸­å³¶å—æ–¹ ãƒãƒƒãƒ—ï¼ˆä¸‹éƒ¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼é€£å‹•ï¼‰</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<style>
  :root {{ --bar-h: 160px; }}
  html, body {{ height: 100%; margin: 0; }}
  #map {{ position: absolute; inset: 0; }}
  /* add safe padding so popups don't hide behind bar */
  .top-pad {{ height: 0; }}
  .bottom-gallery {{
    position: fixed; left: 0; right: 0; bottom: 0;
    height: var(--bar-h);
    background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.98));
    border-top-left-radius: 16px; border-top-right-radius: 16px;
    box-shadow: 0 -6px 20px rgba(0,0,0,0.15);
    display: flex; flex-direction: column;
    backdrop-filter: blur(4px);
  }}
  .bar-header {{
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 12px 4px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  }}
  .handle {{ width: 40px; height: 4px; border-radius: 2px; background: #ccc; margin: 6px auto 4px; }}
  .scroller {{
    display: grid; grid-auto-flow: column; grid-auto-columns: 58%;
    overflow-x: auto; gap: 12px; padding: 8px 12px 14px;
    -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory;
  }}
  @media (min-width: 680px) {{ .scroller {{ grid-auto-columns: 260px; }} }}
  .card {{
    scroll-snap-align: start; border-radius: 14px; overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); background: #fff;
    display: grid; grid-template-rows: auto 1fr;
    min-width: 220px;
  }}
  .thumb {{ width: 100%; height: 110px; object-fit: cover; }}
  .meta {{ padding: 8px 10px 10px; display: grid; gap: 6px; }}
  .title {{ font-weight: 700; font-size: 14px; line-height: 1.2; }}
  .sub {{ font-size: 12px; color: #666; }}
  .btn-row {{ display: flex; gap: 8px; }}
  .btn {{ flex: 1; font-size: 13px; padding: 8px 10px; border-radius: 10px; border: 1px solid #ddd; background: #f9f9f9; }}
  .btn.primary {{ background: #111; color: #fff; border-color: #111; }}
  .tap-area {{ position: absolute; inset: 0; }}
  /* marker and pulse */
  .emoji-marker {{
    background: #fff; border: 2px solid #333; border-radius: 16px;
    width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
    font-size: 18px; line-height: 32px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }}
  .pulse {{
    width: 20px; height: 20px; border-radius: 50%;
    background: rgba(0, 153, 255, 0.4);
    box-shadow: 0 0 0 rgba(0, 153, 255, 0.6);
    animation: pulse 1.2s ease-out 2;
  }}
  @keyframes pulse {{
    0% {{ transform: scale(0.5); opacity: 0.8; }}
    70% {{ transform: scale(2.2); opacity: 0.2; }}
    100% {{ transform: scale(2.8); opacity: 0; }}
  }}
  .toast {{
    position: fixed; left: 50%; transform: translateX(-50%);
    bottom: calc(var(--bar-h) + 8px); background: rgba(0,0,0,0.7); color: #fff;
    padding: 6px 10px; border-radius: 8px; font-size: 12px; z-index: 1000; display: none;
  }}
</style>
</head>
<body>
<div id="map"></div>
<div class="toast" id="toast">ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã—ã¾ã—ãŸ</div>

<div class="bottom-gallery" id="gallery">
  <div class="handle" id="toggleHandle"></div>
  <div class="bar-header">
    <div style="font-weight:700">çœ‹æ¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆã‚¿ãƒƒãƒ—ã§åœ°å›³ã«åæ˜ ï¼‰</div>
    <button id="collapseBtn" class="btn" style="width:auto; padding:6px 10px">éš ã™</button>
  </div>
  <div class="scroller" id="scroller"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
  const places = [{"id": "issho", "name": "æ¿å‰ç„¼è‚‰ ä¸€ç¬‘ è¥¿ä¸­å³¶", "lat": 34.728318, "lng": 135.500197, "genre": "ç„¼è‚‰", "homepage": "https://k726002.gorp.jp/", "comment": "å’Œç‰›ä¸­å¿ƒã€‚ä¸Šå¡©ã‚¿ãƒ³ãƒ»ç‰¹ä¸Šãƒ­ãƒ¼ã‚¹ãƒ»ç‰¹é¸ãƒãƒ©ãƒŸãŒè©•åˆ¤ã€‚", "img": "https://images.unsplash.com/photo-1617195737496-7eafc7870a8a?q=80&w=800&auto=format&fit=crop"}, {"id": "kisshan", "name": "è‚‰è™• ãã£ã—ã‚ƒã‚“ è¥¿ä¸­å³¶ç·æœ¬åº—", "lat": 34.726623, "lng": 135.500157, "genre": "ç„¼è‚‰", "homepage": "https://mjybeef.com/sohonten/", "comment": "A5ä½è³€ç‰›ã‚’ä¸­å¿ƒã«åšåˆ‡ã‚Šã‚¿ãƒ³ã‚„â€œã™ãã‚„ããƒ­ãƒ¼ã‚¹â€ãŒåç‰©ã€‚", "img": "https://images.unsplash.com/photo-1553532435-93d532a45f51?q=80&w=800&auto=format&fit=crop"}, {"id": "icchou", "name": "ä¸ƒè¼ªç„¼é³¥ ä¸€é³¥ è¥¿ä¸­å³¶åº—", "lat": 34.726148, "lng": 135.500025, "genre": "ç„¼ãé³¥", "homepage": "https://nishinakajima.yakitori-icchou.com/", "comment": "ç‚­ç«ç„¼ãã®ç‹é“ã€‚çš®ãƒ»ã›ã›ã‚Šãƒ»ãƒ¤ã‚²ãƒ³ãªã©ä¸²ãŒå……å®Ÿã€‚", "img": "https://images.unsplash.com/photo-1603252109303-2751441dd157?q=80&w=800&auto=format&fit=crop"}, {"id": "ennoba", "name": "å‚™é•·ç‚­ç„¼ãé³¥ ãˆã‚“ã®ã° è¥¿ä¸­å³¶åº—", "lat": 34.726278, "lng": 135.49906, "genre": "ç„¼ãé³¥", "homepage": "https://tabelog.com/osaka/A2701/A270301/27137141/", "comment": "å‚™é•·ç‚­ã®ä¸²ã¨åœ°é¶ã‚‚ã‚‚ç‚­ç«ç„¼ã€‚ã€†ã®é¶ã ã—èŒ¶æ¼¬ã‘ã‚„é¶ç™½æ¹¯ã‚‚â—", "img": "https://images.unsplash.com/photo-1674674538250-814990a21f5c?q=80&w=800&auto=format&fit=crop"}, {"id": "arigatayaa", "name": "ä¸‹ç”ºå±…é…’å±‹ ã‚ã‚ŠãŒãŸã‚„ãã€œ", "lat": 34.726724, "lng": 135.499319, "genre": "å±…é…’å±‹", "homepage": "https://arigatayaa.foodre.jp/", "comment": "é¶ãŠé€ ã‚ŠãŒçœ‹æ¿ã€‚â€œæ˜­å’Œã®ã‹ã—ã‚æšã’â€â€œã¡ã‚Šã¨ã‚Šãƒ›ãƒ«ãƒ¢ãƒ³â€ã‚‚äººæ°—ã€‚", "img": "https://images.unsplash.com/photo-1553621042-f6e147245754?q=80&w=800&auto=format&fit=crop"}, {"id": "uogura", "name": "é…’ã‚¹ã‚¿ãƒ³ãƒ‰ é­šè”µ è¥¿ä¸­å³¶3ä¸ç›®åº—", "lat": 34.725921, "lng": 135.498952, "genre": "ç«‹ã¡é£²ã¿", "homepage": "https://kc8d206.gorp.jp/", "comment": "ç«‹ã¡é£²ã¿æµ·é®®ã€‚åˆºèº«5ç¨®ç››ãªã©é®®é­šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒçœ‹æ¿ã€‚", "img": "https://images.unsplash.com/photo-1579586337278-3befd40fd17a?q=80&w=800&auto=format&fit=crop"}, {"id": "kinjishi", "name": "ç«‹å–°é…’å ´ é‡‘ç…å­ è¥¿ä¸­å³¶å—æ–¹åº—", "lat": 34.72651, "lng": 135.497686, "genre": "ç«‹ã¡é£²ã¿", "homepage": "https://tabelog.com/osaka/A2701/A270301/27067834/", "comment": "æ—¥æ›¿ã‚ã‚Šã®é­šä»‹ã‚„ä¸€å“ãŒæ¥½ã—ã„ç«‹ã¡é£²ã¿ã€‚â€œãƒ“ãƒ•ãƒ†ã‚­â€ã‚‚äººæ°—ã€‚", "img": "https://images.unsplash.com/photo-1569084072447-3e452ad4a1a5?q=80&w=800&auto=format&fit=crop"}, {"id": "bonkuraya", "name": "ã‚„ãã‚„ãé‰„æ¿ ã¼ã‚“ãã‚‰å®¶ è¥¿ä¸­å³¶åº—", "lat": 34.726704, "lng": 135.499248, "genre": "é‰„æ¿/ãŠå¥½ã¿ç„¼ã", "homepage": "https://c770939.gorp.jp/", "comment": "åç‰©â€œç‰›ã™ã˜ã‚³ãƒ³ãã°ã‚ã—â€ã€‚ç²‰ã‚‚ã‚“ï¼†é‰„æ¿ã¤ã¾ã¿ãŒè±Šå¯Œã€‚", "img": "https://images.unsplash.com/photo-1604908554036-8e47abd3823d?q=80&w=800&auto=format&fit=crop"}, {"id": "kazu", "name": "ã­ãç„¼ãƒ»ãŠå¥½ã¿ç„¼ã å’Œï¼ˆã‹ãšï¼‰", "lat": 34.725893, "lng": 135.499686, "genre": "é‰„æ¿/ãŠå¥½ã¿ç„¼ã", "homepage": "https://tabelog.com/osaka/A2701/A270301/27018403/", "comment": "é†¤æ²¹å‘³ã®â€œã™ã˜ã­ãç„¼â€ãŒåç‰©ã€‚é‡ã­ç„¼ãã‚¹ã‚¿ã‚¤ãƒ«ã§é¦™ã°ã—ã„ã€‚", "img": "https://images.unsplash.com/photo-1625948483852-8e6b18423512?q=80&w=800&auto=format&fit=crop"}, {"id": "sugidama", "name": "é®¨ãƒ»é…’ãƒ»è‚´ æ‰ç‰ è¥¿ä¸­å³¶å—æ–¹", "lat": 34.725894, "lng": 135.499717, "genre": "å¯¿å¸", "homepage": "https://www.sugidama-sushiizakaya.jp/shop/505/", "comment": "â€œé›²ä¸¹ã¨ã„ãã‚‰ã®ã“ã¼ã‚Œè»è‰¦â€ãªã©æ˜ ãˆï¼†ã‚³ã‚¹ãƒ‘é®¨ã€‚", "img": "https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=800&auto=format&fit=crop"}, {"id": "yagura", "name": "ã‚„ãã‚‰å¯¿ã—", "lat": 34.725468, "lng": 135.499528, "genre": "å¯¿å¸", "homepage": "https://www.yagurasushi.com/", "comment": "æ˜­å’Œ39å¹´å‰µæ¥­ã®ç”ºå¯¿å¸ã€‚ã«ãã‚Šç››ã‚Šã‚„ç®±å¯¿å¸ã§ã—ã£ã‹ã‚Šã€‚", "img": "https://images.unsplash.com/photo-1625948552406-30f938a713b7?q=80&w=800&auto=format&fit=crop"}, {"id": "jinrui", "name": "äººé¡ã¿ãªéººé¡", "lat": 34.72551, "lng": 135.499043, "genre": "ãƒ©ãƒ¼ãƒ¡ãƒ³", "homepage": "https://www.jinrui-minamenrui.com/", "comment": "â€œåŸç‚¹ / micro / macroâ€ã®ä¸‰æœ¬æŸ±ã€‚macroã¯è²ç³»ã§ä¸€ç•ªäººæ°—ã€‚", "img": "https://images.unsplash.com/photo-1557872943-16a5ac26437b?q=80&w=800&auto=format&fit=crop"}, {"id": "hanamichi", "name": "éººåŒ  ã¯ãªã¿ã¡ æ–°å¤§é˜ªåº—", "lat": 34.727637, "lng": 135.497114, "genre": "ãƒ©ãƒ¼ãƒ¡ãƒ³", "homepage": "https://menshohanamichi.jp/free/shinosaka", "comment": "æ¿ƒåšè±šéª¨ã—ã‚‡ã†ã‚†â€œç‰¹ä¸Šã—ã‚‡ã†ã‚†â€ã‚„å‘³å™ŒãŒå®šç•ªã€‚æ·±å¤œ5æ™‚ã¾ã§ã€‚", "img": "https://images.unsplash.com/photo-1604908177079-0c3fae48005c?q=80&w=800&auto=format&fit=crop"}, {"id": "stinger", "name": "Public Bar STINGERï¼ˆ5Fï¼‰", "lat": 34.725868, "lng": 135.499013, "genre": "ãƒãƒ¼", "homepage": "https://stinger2017.jp/", "comment": "è‹±å›½ãƒ‘ãƒ–ã€‚ãƒ•ã‚£ãƒƒã‚·ãƒ¥ï¼†ãƒãƒƒãƒ—ã‚¹ã€ãƒ­ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¼ãƒ•ã€ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«ãƒ€ãƒ¼ãƒ„å¸¸è¨­ã€‚", "img": "https://images.unsplash.com/photo-1500644970114-4ff3c3dfb61f?q=80&w=800&auto=format&fit=crop"}];
  const genreEmojis = {"ç„¼è‚‰": "ğŸ¥©", "ç„¼ãé³¥": "ğŸ¢", "å±…é…’å±‹": "ğŸ¶", "ç«‹ã¡é£²ã¿": "ğŸº", "é‰„æ¿/ãŠå¥½ã¿ç„¼ã": "ğŸ”¥", "å¯¿å¸": "ğŸ£", "ãƒ©ãƒ¼ãƒ¡ãƒ³": "ğŸœ", "ãƒãƒ¼": "ğŸ¸"};
  const map = L.map('map').setView([34.726, 135.4993], 16);
  L.tileLayer('https://{{s}}.tile.openstreetmap.org/{{z}}/{{x}}/{{y}}.png', {{ maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }}).addTo(map);

  const markers = new Map();
  const layersByGenre = {{}};

  function iconForGenre(g) {{
    const emoji = genreEmojis[g] || "ğŸ“";
    return L.divIcon({{
      html: `<div class="emoji-marker">${{emoji}}</div>`,
      className: '',
      iconSize: [32,32], iconAnchor: [16,16], popupAnchor: [0,-16]
    }});
  }}

  // Create markers & popups
  for (const p of places) {{
    if (!layersByGenre[p.genre]) layersByGenre[p.genre] = L.layerGroup().addTo(map);
    const marker = L.marker([p.lat, p.lng], {{ icon: iconForGenre(p.genre), title: p.name }});
    marker.bindPopup(`
      <div style="min-width:220px">
        <div style="font-weight:700; margin-bottom:4px;">${{p.name}}</div>
        <div style="color:#555; margin-bottom:6px;">ã‚¸ãƒ£ãƒ³ãƒ«ï¼š${{p.genre}}</div>
        <div style="margin-bottom:6px;">${{p.comment}}</div>
        <a href="${{p.homepage}}" target="_blank" rel="noopener">å…¬å¼/æƒ…å ±ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a>
      </div>
    `);
    marker.addTo(layersByGenre[p.genre]);
    markers.set(p.id, marker);
  }}

  // Pulse highlight at location
  function pulseAt(lat, lng) {{
    const pulseIcon = L.divIcon({{ html: '<div class="pulse"></div>', className: '', iconSize: [20,20], iconAnchor: [10,10] }});
    const temp = L.marker([lat, lng], {{ icon: pulseIcon, interactive: false }}).addTo(map);
    setTimeout(() => map.removeLayer(temp), 2200);
  }}

  // Focus a place by id
  function focusPlace(id) {{
    const p = places.find(x => x.id === id);
    if (!p) return;
    const marker = markers.get(id);
    // pan the map so popup appears above bottom bar
    const offsetY = window.innerHeight * 0.18;
    map.flyTo([p.lat, p.lng], 17, {{ duration: 0.6 }});
    setTimeout(() => {{ marker.openPopup(); map.panBy([0, -offsetY], {{ animate: true }}); pulseAt(p.lat, p.lng); showToast(); }}, 620);
  }}

  // Simple toast feedback
  function showToast() {{
    const t = document.getElementById('toast');
    t.style.display = 'block';
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => t.style.display = 'none', 1300);
  }}

  // Build bottom cards
  const scroller = document.getElementById('scroller');
  for (const p of places) {{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img class="thumb" src="${{p.img}}" alt="${{p.name}}ã®çœ‹æ¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†™çœŸ" loading="lazy">
      <div class="meta">
        <div class="title">${{p.name}}</div>
        <div class="sub">${{p.genre}} ï½œ ã‹ã‚“ãŸã‚“ä½ç½®è¡¨ç¤º</div>
        <div class="btn-row">
          <button class="btn primary" data-id="${{p.id}}">åœ°å›³ã§è¦‹ã‚‹</button>
          <a class="btn" href="${{p.homepage}}" target="_blank" rel="noopener">å…¬å¼</a>
        </div>
      </div>
    `;
    // main button focus
    card.querySelector('button[data-id]').addEventListener('click', (e) => {{
      const id = e.currentTarget.getAttribute('data-id');
      focusPlace(id);
    }});
    // also allow tapping image to focus
    card.querySelector('.thumb').addEventListener('click', () => focusPlace(p.id));
    scroller.appendChild(card);
  }}

  // Collapsible gallery for more map space
  const gallery = document.getElementById('gallery');
  const collapseBtn = document.getElementById('collapseBtn');
  const toggleHandle = document.getElementById('toggleHandle');
  let collapsed = false;
  function setCollapsed(state) {{
    collapsed = state;
    if (collapsed) {{
      gallery.style.transform = 'translateY(calc(var(--bar-h) - 24px))';
      collapseBtn.textContent = 'é–‹ã';
    }} else {{
      gallery.style.transform = 'translateY(0)';
      collapseBtn.textContent = 'éš ã™';
    }}
  }}
  collapseBtn.addEventListener('click', () => setCollapsed(!collapsed));
  toggleHandle.addEventListener('click', () => setCollapsed(!collapsed));
</script>
</body>
</html>
